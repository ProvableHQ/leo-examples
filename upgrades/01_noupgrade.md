# Non-upgradable Programs
In many cases, developers will want to deploy a program that is not upgradable.
This is the default mode supported by Leo.
Let's take a look at a simple example.

## Initializing the Project
```bash
> leo new noupgrade_example
> cd noupgrade_example
```

Observe that the `program.json` file has been created with a `"noupgrade"` configuration.
```json
{
  "program": "noupgrade_example.aleo",
  "version": "0.1.0",
  "description": "",
  "license": "MIT",
  "dependencies": null,
  "upgrade": {
    "mode": "noupgrade"
  }
}
```

## The Program
```leo
// The 'noupgrade_example' program.
program noupgrade_example.aleo {
    transition main(public a: u32, b: u32) -> u32 {
        let c: u32 = a + b;
        return c;
    }
    
    // This is the constructor for the program.
    // It is called when the program is deployed or upgraded.
    // It is currently configured to **prevent** upgrades.
    // For more information, please refer to the documentation: ...
    async constructor() {
        assert_eq(self.edition, 0u16);
    }
}
```

Note the default constructor that is automatically generated by the Leo compiler.
This constructor is **immutable** and is called every time the program is deployed or upgraded.
The constructor checks that the program's edition (version) is `0`.
The version is automatically assigned when the network processes the deployment. 
If the program is already deployed on the network, the assigned version will be non-zero, the constructor will fail to execute, and the deployment will be rejected.

The Leo compiler will reference this configuration in `program.json` and check that the code matches the declared mode. 
For example, if we were to modify the constructor in any way, the Leo compiler would throw an error.

```bash
> leo build
Error [ESAZ0374011]: The constructor is not well-formed for the 'noupgrade' upgrade configuration.
    --> .../upgrades/noupgrade_example/src/main.leo:12:5
     |
  12 |     async constructor() {
     |     ^^^^^^^^^^^^^^^^^^^^^
  13 |         assert_eq(self.edition, 1u16);
     |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  14 |     }
     |     ^
     |
     = 
The expected constructor is:

async constructor() {
  assert_eq(self.edition, 0u16);
}

For more information, please refer to the documentation: ...
```

## Deploying the Program
```bash
> leo deploy --broadcast
       Leo     6 statements before dead code elimination.
       Leo     6 statements after dead code elimination.
       Leo ✅ Compiled 'noupgrade_example.aleo' into Aleo instructions
Attempting to determine the consensus version from the latest block height at http://localhost:3030...

🛠️  Deployment Plan Summary
──────────────────────────────────────────────
🔧 Configuration:
  Private Key:       APrivateKey1zkp8CZNn3yeC...
  Address:           aleo1rhgdu77hgyqd3xjj8uc...
  Endpoint:          http://localhost:3030
  Network:           testnet
  Consensus Version: 7

📦 Deployment Tasks:
+------------------------+------------+----------+--------------+-----------------+
| Program                | Upgrade    | Base Fee | Priority Fee | Fee Record      |
+------------------------+------------+----------+--------------+-----------------+
| noupgrade_example.aleo | no upgrade | auto     | 0            | no (public fee) |
+------------------------+------------+----------+--------------+-----------------+

⚙️ Actions:
  - Your transaction(s) will NOT be printed to the console.
  - Your transaction(s) will NOT be saved to a file.
  - Your transaction(s) will be broadcast to http://localhost:3030
──────────────────────────────────────────────

✔ Do you want to proceed with deployment? · yes

📦 Creating deployment transaction for 'noupgrade_example.aleo'...

'noupgrade_example.aleo' does not allow upgrades and CANNOT be changed after deployment.
✔ Do you want to proceed? · yes


📊 Deployment Stats for noupgrade_example.aleo
Total Variables:       17,275
Total Constraints:     12,927

Base deployment cost for 'noupgrade_example.aleo' is 2.691050 credits.

+------------------------+----------------+
| noupgrade_example.aleo | Cost (credits) |
+------------------------+----------------+
| Transaction Storage    | 0.886000       |
+------------------------+----------------+
| Program Synthesis      | 0.755050       |
+------------------------+----------------+
| Constructor            | 0.050000       |
+------------------------+----------------+
| Namespace              | 1.000000       |
+------------------------+----------------+
| Priority Fee           | 0.000000       |
+------------------------+----------------+
| Total                  | 2.691050       |
+------------------------+----------------+

📡 Broadcasting deployment for noupgrade_example.aleo...
💰Your current public balance is 93749995.534724 credits.

✔ This transaction will cost you 2.69105 credits. Do you want to proceed? · yes

✅ Successfully broadcast deployment with:
  - transaction ID: 'at187cjs6uujyh4q6xrdldfyzwzejy9tnux05kqkc9nhqkxcc4khgqqdtk429'
  - fee ID: 'au1y77m9zhpm6zjyhv8rtr524l4ace4qq5h863t25rnvl0vvjxztyqqtm64tf'
⏲️ Waiting for 15 seconds to allow the deployment to confirm...
```

If we query the network, we can see that the deployment transaction has been accepted.
```
http://localhost:3030/testnet/transaction/at187cjs6uujyh4q6xrdldfyzwzejy9tnux05kqkc9nhqkxcc4khgqqdtk429
```

## Attempting an Upgrade
First, let's change the source code by modifying the addition operation to a subtraction operation.
Now, let's try to upgrade the program.

```
> leo upgrade --broadcast
       Leo     6 statements before dead code elimination.
       Leo     6 statements after dead code elimination.
       Leo ✅ Compiled 'noupgrade_example.aleo' into Aleo instructions
Attempting to determine the consensus version from the latest block height at http://localhost:3030...

🛠️  Deployment Plan Summary
──────────────────────────────────────────────
🔧 Configuration:
  Private Key:    APrivateKey1zkp8CZNn3yeC...
  Address:        aleo1rhgdu77hgyqd3xjj8uc...
  Endpoint:       http://localhost:3030
  Network:        testnet
  Consensus Version:7

📦 Deployment Tasks:
+------------------------+------------+----------+--------------+-----------------+
| Program                | Upgrade    | Base Fee | Priority Fee | Fee Record      |
+------------------------+------------+----------+--------------+-----------------+
| noupgrade_example.aleo | no upgrade | auto     | 0            | no (public fee) |
+------------------------+------------+----------+--------------+-----------------+

⚙️ Actions:
  - Your transaction(s) will NOT be printed to the console.
  - Your transaction(s) will NOT be saved to a file.
  - Your transaction(s) will be broadcast to http://localhost:3030
──────────────────────────────────────────────

✔ Do you want to proceed with upgrade? · yes

📦 Creating deployment transaction for 'noupgrade_example.aleo'...


📊 Deployment Stats for noupgrade_example.aleo
Total Variables:       17,276
Total Constraints:     12,929

Base deployment cost for 'noupgrade_example.aleo' is 2.691125 credits.

+------------------------+----------------+
| noupgrade_example.aleo | Cost (credits) |
+------------------------+----------------+
| Transaction Storage    | 0.886000       |
+------------------------+----------------+
| Program Synthesis      | 0.755125       |
+------------------------+----------------+
| Constructor            | 0.050000       |
+------------------------+----------------+
| Namespace              | 1.000000       |
+------------------------+----------------+
| Priority Fee           | 0.000000       |
+------------------------+----------------+
| Total                  | 2.691125       |
+------------------------+----------------+

📡 Broadcasting deployment for noupgrade_example.aleo...
💰Your current public balance is 93749935.169134 credits.

✔ This transaction will cost you 2.691125 credits. Do you want to proceed? · yes

✅ Successfully broadcast deployment with:
  - transaction ID: 'at1ayz3tm4hwjweqe3a82q2wk4thh368z4q2djxf4fetw7eh8wx8szsr5llcc'
  - fee ID: 'au1wvtzg4s5da94lmavg2k8hq8t6g340pehq07yfuy6mwqwqthj8sqsfuye3g'
⏲️ Waiting for 15 seconds to allow the deployment to confirm...
```

If we query the network, we can see that the upgrade transaction has been rejected, because only a fee transaction is deployed.
```
http://localhost:3030/testnet/transaction/at1ayz3tm4hwjweqe3a82q2wk4thh368z4q2djxf4fetw7eh8wx8szsr5llcc
```





